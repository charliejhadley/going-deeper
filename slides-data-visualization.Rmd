---
title: "Advanced Data Visualization"
subtitle: "Going Deeper with R"
output:
  xaringan::moon_reader:
    css: ["style.css", "default"]
    lib_dir: libs
    df_print: paged
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
---

```{r child = "setup.Rmd"}
```

```{r eval = TRUE, echo = FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(knitr)
```

---

class: center, middle, dk-section-title

background-image:url("images/highlight.jpg")

# Highlight

---

class: center, middle, dk-section-title

background-image:url("images/declutter.jpg")

# Declutter


---

class: center, middle, dk-section-title

background-image:url("images/explain.jpg")

# Explain


---

class: center, middle, dk-section-title

background-image:url("images/sparkle.jpg")

# Sparkle

---

class: inverse

---

class: center, middle, dk-section-title

background-image:url("images/highlight.jpg")

# Highlight

---

## Reorder Plots to Highlight Findings

```{r eval = TRUE}
math_scores_chronic_absenteeism <- read_rds("data/math_scores_chronic_absenteeism.rds")
```

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school)) +
  geom_col()
```


---

## Reorder Plots to Highlight Findings


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = reorder(school, percent_not_proficient_math))) +
  geom_col()
```

---


## Reorder Plots to Highlight Findings


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school)) +
  geom_col()
```

---

## Use Color to Highlight Findings


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school)) +
  geom_col() +
  geom_col(data = filter(math_scores_chronic_absenteeism, school == "Glendale Elementary School"),
           fill = "red")
```

---

## Use Color to Highlight Findings


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school)) +
  geom_col() +
  geom_col(data = filter(math_scores_chronic_absenteeism, #<<
                         percent_not_proficient_math == max(percent_not_proficient_math)), #<<
           fill = "red")
```

---

## Use Color to Highlight Findings


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", #<<
    TRUE ~ "N" #<<
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) #<<
```

---

class: center, middle, dk-section-title

background-image:url("images/declutter.jpg")

# Declutter

---

## Remove Unnecessary Elements: Axis Titles

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) +
  labs(x = NULL, #<<
       y = NULL) #<<
```

---

## Remove Unnecessary Elements: Axis Titles

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) +
  theme_void()
```

---

## Remove Unnecessary Elements: Axis Titles

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) +
  theme(axis.title = element_blank()) #<<
```

---

## Remove Unnecessary Elements: Legends

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) +
  theme(axis.title = element_blank(),
        legend.position = "none") #<<
```

---

## Remove Unnecessary Elements: Legends

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col(show.legend = FALSE) + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme(axis.title = element_blank()) 
```

---

## Remove Unnecessary Elements: Backgrounds

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(axis.text.y = element_text(family = "Arial", #<<
                                   hjust = 1), #<<
        legend.position = "none") #<<
```




---
## Working with Existing Themes

Actual themes
- Use hrbrthemes + show various options
- Link to themes RRU blog post
- https://github.com/jmcastagnetto/ggplot2_themes_in_github/




---

class: center, middle, dk-section-title

background-image:url("images/explain.jpg")

# Explain

---

## Use Direct Labeling

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent_not_proficient_math)) + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(axis.text.y = element_text(family = "Arial",
                                   hjust = 1), 
        legend.position = "none") 
```

---

## Use Direct Labeling

```{r eval = TRUE}
library(scales)

math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math))) + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(axis.text.y = element_text(family = "Arial",
                                   hjust = 1), 
        legend.position = "none") 
```

---

## Use Direct Labeling

```{r eval = TRUE}
library(scales)

math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math),
                hjust = 1.2)) + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(axis.text.y = element_text(family = "Arial",
                                   hjust = 1), 
        legend.position = "none") 
```

---

## Use Direct Labeling

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  # view()
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math),
                hjust = 1.2)) + 
  geom_text(aes(x = 0.02,
                y = school,
                label = school),
            hjust = 0) +
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(legend.position = "none") 
```


## Use Titles That Tell the Story


```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math),
                hjust = 1.2)) + 
  geom_text(aes(x = 0.02,
                y = school,
                label = school),
            hjust = 0) +
  labs(title = "Glendale Elementary School Has the Highest Percent of Students Not Proficient in Math in Oregon") + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(legend.position = "none") 
```

---

## Use Titles That Tell the Story

```{r eval = TRUE}
math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math),
                hjust = 1.2)) + 
  geom_text(aes(x = 0.02,
                y = school,
                label = school),
            hjust = 0) +
  labs(title = "Glendale Elementary School Has the Highest Percent of Students Not Proficient in Math in Oregon") + #<<
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(legend.position = "none",
        plot.title = element_text(face = "bold")) 
```

---

## Use Titles That Tell the Story

```{r eval = TRUE}
library(ggtext)

math_scores_chronic_absenteeism %>% 
  top_n(10, percent_not_proficient_math) %>% 
  mutate(school = fct_reorder(school, percent_not_proficient_math)) %>% 
  mutate(school_to_highlight = case_when( #<<
    percent_not_proficient_math == max(percent_not_proficient_math) ~ "Y", 
    TRUE ~ "N" 
  )) %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = school,
             fill = school_to_highlight)) +
  geom_col() +
  geom_text(aes(label = percent(percent_not_proficient_math),
                hjust = 1.2)) + 
  geom_text(aes(x = 0.02,
                y = school,
                label = school),
            hjust = 0) +
      labs(title = "**<span style='color:#FF0000'>Glendale Elementary School</span>** Has the Highest Percent of<br>Students Not Proficient in Math in Oregon") +
  scale_fill_manual(values = c("gray", "red")) +
  theme_void() + #<<
  theme(legend.position = "none",
        plot.title = element_textbox(margin = margin(0, 0, 10, 30))) 
```




## Annotations

```{r}
math_scores_chronic_absenteeism %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = percent_chronically_absent)) +
  geom_point()
```

```{r}
library(gghighlight)
math_scores_chronic_absenteeism %>% 
  ggplot(aes(x = percent_not_proficient_math,
             y = percent_chronically_absent)) +
  geom_bin2d()
  geom_histogram()
  geom_point(alpha = 0.5) +
  gghighlight(percent_chronically_absent == max(percent_chronically_absent)) +
  scale_y_continuous(limits = c(0, 0.55),
                     labels = percent_format()) +
  scale_x_continuous(limits = c(0, 1),
                     labels = percent_format()) +
  theme_minimal() +
  labs(x = "Percent of Third Graders NOT Proficient in Math",
       y = "Percent Chronically Absent")
```

???
Add FT tweet from 1/23/20 from John Murdoch to show it
http://www.thefunctionalart.com/2020/01/an-example-of-how-to-annotate.html


## ggrepel

# Make it Sparkle

## Don't Use Defaults

## Custom themes

theme() function <- use this as place to demonstrate user-made functions

- Use hrbrthemes + show various options
- Link to themes RRU blog post
- https://github.com/jmcastagnetto/ggplot2_themes_in_github/

## Custom fonts

Plotting + saving (i.e. use device = cairo_pdf)

https://www.andrewheiss.com/blog/2017/09/27/working-with-r-cairo-graphics-custom-fonts-and-ggplot/

## ggplot extensions

- gganimate
- ggridges
- https://github.com/corybrunson/ggalluvial
- [ggalt](https://github.com/hrbrmstr/ggalt) (lollipops, dumbells, etc.)
- [ggbeeswarm](https://github.com/eclarke/ggbeeswarm)
- https://ggraph.data-imaginist.com/
- https://github.com/ricardo-bion/ggradar
- https://github.com/econandrew/ggtreemap
- https://github.com/hrbrmstr/waffle
- Patchwork

Collections
- http://www.ggplot2-exts.org/gallery/
- [From Data to Viz](https://www.data-to-viz.com/)
- https://github.com/erikgahner/awesome-ggplot2





